<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout-board}">

<head>
    <title>멘토링 상세보기</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <th:block layout:fragment="css">
        <link rel="stylesheet" href="/css/mentoringRequest/mentoringDetail.css">
    </th:block>
</head>

<body>
<div layout:fragment="content">
    <div class="card">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2>멘토링 신청 상세</h2>
            <!-- 신고 버튼 추가 -->
            <button id="reportMentoringBtn" class="btn btn-outline-danger btn-sm" title="멘토링 신고">
                신고하기
            </button>
        </div>

        <div class="detail-row"><strong>멘토:</strong> <span id="mentorName"></span></div>
        <div class="detail-row"><strong>멘티:</strong> <span id="userName"></span></div>
        <div class="detail-row"><strong>주제:</strong> <span id="topic"></span></div>
        <div class="detail-row"><strong>메시지:</strong> <span id="message"></span></div>
        <div class="detail-row"><strong>신청일:</strong> <span id="createdAt"></span></div>
        <div class="detail-row"><strong>상태:</strong> <span id="status-display"></span></div>

        <!-- 대기 중일 때 수락/거절 버튼 -->
        <div class="btn-group mt-4" id="actionButtons" style="display: none;">
            <div class="d-flex gap-2 justify-content-center">
                <button class="btn btn-outline-success px-4 py-2" onclick="accept()">
                    <i class="fas fa-check me-1"></i>수락
                </button>
                <button class="btn btn-outline-danger px-4 py-2" onclick="reject()">
                    <i class="fas fa-times me-1"></i>거절
                </button>
            </div>
        </div>

        <!-- 수락된 상태일 때 일정 관리 -->
        <div id="schedule-section" style="display: none;">
            <h5>일정 관리</h5>
            <label for="scheduleDate">멘토링 날짜 제안:</label>
            <input type="datetime-local" id="scheduleDate" min="">
            <button id="proposeBtn" class="btn btn-primary btn-sm mt-2">일정 제안</button>
            <button id="confirmBtn" class="btn btn-success btn-sm mt-2" style="display:none;">상대 제안 수락</button>
        </div>

        <!-- 일정 확정된 경우 -->
        <div id="confirmed-schedule" style="margin-top: 20px; display: none;">
            <h5>확정된 일정</h5>
            <p><strong>일정:</strong> <span id="scheduleDisplay"></span></p>
            <p><strong>세션 링크:</strong> <a id="sessionLink" href="#" target="_blank"></a></p>
            <button class="btn btn-outline-primary" id="goToRoomBtn">멘토링 방 이동</button>
        </div>

        <!-- 멘토링 완료 처리 섹션 -->
        <div id="complete-section" class="complete-section" style="display: none;">
            <h5>멘토링 완료 처리</h5>
            <p class="text-muted mb-3">멘토링이 끝났다면 완료 처리를 해주세요.</p>
            <div class="d-flex gap-2">
                <button class="btn btn-success" onclick="completeMentoring()">
                    멘토링 완료
                </button>
            </div>
        </div>

        <!-- 완료된 멘토링 표시 -->
        <div id="completed-section" style="display: none;">
            <div class="alert alert-success mt-4">
                <h5> 멘토링 완료!</h5>
                <p class="mb-2">멘토링이 성공적으로 완료되었습니다.</p>
                <a href="/mentoringReview" class="btn btn-outline-success btn-sm">
                    리뷰 작성하기
                </a>
            </div>
        </div>

        <!-- 목록으로 돌아가기 버튼 -->
        <div class="mt-4">
            <a href="/mentoring" class="btn btn-secondary">목록으로 돌아가기</a>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
    <script th:src="@{/js/mentorRequest/mentoringDetail.js}"></script>
</th:block>
</body>
</html>